<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CodeWars8086</title>
    <script type="text/javascript" language="javascript" src="asm_js_main.js"></script>
    <script type="text/javascript" language="javascript" src="codewars_js/codewars_js.nocache.js"></script>  
<script>
"use strict";

var run_nasm = null
var PAGE_SIZE = 512
var LAST_PART_INDEX = Math.trunc(65535/PAGE_SIZE)

var did_start = false

var selcount = 1

function start()
{
    if (did_start)
        return;
    console.log("start()");
    run_nasm = Module.cwrap('run_nasm', null, ['string', 'string'])
    Module['print'] = printConsole
    Module['printErr'] = printConsole

    asm_edit.addEventListener("keydown", fixhscroll)
    asm_edit.addEventListener("keydown", fixTabKey) // want to capture the press since we want to prevent the default action
    asm_edit.addEventListener("keyup", fixhscroll)
    asm_edit.addEventListener("keyup", fixIndent)  // indent is on key up since we want it after the \n

    // asm_pre.addEventListener("mousewheel", asm_pre_mousewheel) not working

    populate_debug_area()
    did_start = true

    document.addEventListener("selectionchange", function() {
    //    var s = document.getSelection();
    //    var r = s.getRangeAt(0)
    //    console.log('Selection changed ' + (selcount++) + "  " + s.rangeCount + " " + r.startContainer.id + ":" + r.startOffset + " - " + r.endContainer.id + ":" + r.endOffset  );

    /*    if (asm_edit.selectionStart == 2) {
            asm_edit.selectionStart = 3;
            console.log("moved")
        }*/

    });

    setup_breakpoints_savers()

    speedSlider.addEventListener("input", function() {
        //speedSliderVal.innerText = speedSlider.value
    })
}


var saved_selectionStart = -1 // need to be int for java to read
var saved_selectionEnd = -1
var saved_keydown = null

// save the text area selection start and end in order to find out how to move the breakpoints
function setup_breakpoints_savers()
{
    asm_edit.addEventListener("keydown", function(e) {
        saved_selectionStart = asm_edit.selectionStart
        saved_selectionEnd = asm_edit.selectionEnd
        saved_keydown = e.key
    })

    var mouseHandler = function(e) {
        saved_selectionStart = asm_edit.selectionStart
        saved_selectionEnd = asm_edit.selectionEnd
        saved_keydown = null
    }
    // do both up and down to be safe. not sure if both are actually needed
    asm_edit.addEventListener("mousedown", mouseHandler)
    asm_edit.addEventListener("mouseup", mouseHandler)
}


function populate_debug_area()
{
    console.log("start addr add")
    var c = document.createDocumentFragment();
    var currentPart = null
    for(var i = 0; i <= 0xffff; ++i) {

        if ((i % PAGE_SIZE) == 0) {
            var parti = i / PAGE_SIZE
            currentPart = document.createElement('div')
            currentPart.classList = "dpart"
            currentPart.id = "dpart" + parti
            currentPart.style.display = ""
            c.appendChild(currentPart)

            var placeholder = document.createElement('div')
            placeholder.classList = "dplace"
            placeholder.id = "dplace" + parti
            placeholder.style.display = "none"

            if (i != 0) { // show the first one so it could give its height to the rest
                currentPart.style.display = "none"
                placeholder.style.display = ""
            }
            c.appendChild(placeholder)
        }
        var addr = i.toString(16).padStart(4, '0')
        var e = document.createElement('div')
        e.classList = 'dline'
        e.id = 'd' + i
        e.innerText = addr

        currentPart.appendChild(e);
    }
    debug_text.appendChild(c)
    console.log("done addr add")
}

function cssRuleBySelector(selText) {
    var rules = document.styleSheets[0].cssRules
    for(var i = 0; i < rules.length; ++i)
        if (rules[i].selectorText == selText)
            return rules[i]
    return null
}

var dplace_css = null
var single_part_height = 0
function fix_debug_scroll_placeholders_size()
{
    if (dplace_css == null)
        dplace_css = cssRuleBySelector('.dplace')
    // part0 is the only one displayed at the start so it would give its height to the rest
    single_part_height = dpart0.offsetHeight
    if (single_part_height == 0)
        throw "did not get placeholder height"
    dplace_css.style.height = dpart0.offsetHeight + "px"
}

// 0 is the only one shown at the start
// this array is always size 2
var last_shown_parts = [0,-1]

function hidePage(i) {
    if (i == -1)
        return
    document.getElementById('dpart' + i).style.display = 'none'
    document.getElementById('dplace' + i).style.display = ''
}
function showPage(i) {
    if (i == -1)
        return
    document.getElementById('dpart' + i).style.display = ''
    document.getElementById('dplace' + i).style.display = 'none'
}

// need to maintain who's open and who's not
// at all time, exactly two parts are open
// force does the scroll painting even if we're already there, need this when starting debug to update dirty pages
function debugAreaScroll(force)
{
    var atScroll = debug_text.scrollTop
    var atpartf = atScroll / single_part_height
    var atpart = Math.trunc(atpartf)
    var where_in_part = atpartf % 1  // fraction part

    var new_shown_parts = [atpart]
    var second_part = (where_in_part > 0.5) ? (atpart + 1) : (atpart - 1)
    if (second_part >= 0 && second_part <= LAST_PART_INDEX) {
        if (second_part > atpart)
            new_shown_parts.push(second_part)
        else
            new_shown_parts = [second_part, atpart] // maintain the first one be the smallest one for the above comparison
    }
    else
        new_shown_parts.push(-1)

    // this will still work fine if the array has only 1 element, [1] in both will be undefined
    if (!force && new_shown_parts[0] == last_shown_parts[0] && new_shown_parts[1] == last_shown_parts[1])
        return

    hidePage(last_shown_parts[0])
    hidePage(last_shown_parts[1])

    showPage(new_shown_parts[0])
    showPage(new_shown_parts[1])

    j_setScrollAt(new_shown_parts[0], new_shown_parts[1]);

    last_shown_parts = new_shown_parts

}

function scrollToAddr(addr) {
    if (addr < 0 || addr > 0xffff)
        return
    var e = document.getElementById("d" + addr)
    if (!e)
        return
    var eoffs = e.offsetTop
    if (eoffs > debug_text.scrollTop && eoffs < debug_text.scrollTop + debug_text.offsetHeight - 30)
        return // already in view, don't need to scroll

    e.parentElement.style.display = ""  // need to show it for it to have an offsetTop
    e.style.display = "" // just in case it is hidden for some reason
    debug_text.scrollTop = e.offsetTop - 30  // have some margin from the top
}

function triggerGoTo() {
    var addr = parseInt(debug_goto.value, 16)
    if (isNaN(addr)) {
        console.error("failed to parse address");
        return
    }
    if (addr < 0  || addr > 0xffff) {
        console.error("address out of range");
    }
    scrollToAddr(addr)
}
function triggerGoToKey() {
    if(event.key !== "Enter")
        return;
    event.preventDefault(); // No need to `return false;`.
    triggerGoTo()
}





// called when GWT finshed loading
function gwtStart()
{
    start();
    console.log("gwtStart()");
   // start with two players
    addPlayersPanel()
    addPlayersPanel()

    sel_code_w1_pA.checked = true
    triggerSrc('pA', 1)

    j_demoDebugPlayers();

    addWatchLine();
    //addWatchLine();
    //addWatchLine();
}


function addTextChild(elem, txt) {
    var dummy = document.createElement("DIV")
    dummy.innerHTML = txt
    elem.appendChild(dummy.firstChild)
}

var g_nextLetter = 'A'
var g_usedLetters = []
var g_srcButtons = []  // ids of elements that are checkboxes that select a source file to be displayer
var g_usedZnums = []

function asciiAdd(letter, val) {
    return String.fromCharCode(letter.charCodeAt(0) + val)
}

function arrayRemove(arr, value) {
    var index = arr.indexOf(value);
    console.assert(index > -1, "did not find " + value)
    arr.splice(index, 1);
}


function addPlayersPanel() {
    if (addPlayerBtn.getAttribute("disabled") == "true")
        return;
    if (g_usedLetters.length >= 20)
        return; // max players

    var text = '<div id="pl_frame_pLETTER" class="toppic">\
          <div class="famtitle">\
            <input class="fam_check_box hidden mycheck" id="player_check_pLETTER" type="checkbox" checked onchange="" >\
            <label class="fam_check mycheck_label" for="player_check_pLETTER"></label>\
            <label id="player_name_lbl_pLETTER" class="fam_label">Player LETTER</label>\
            <label id="player_erase_pLETTER" class="pl_close_icon" onclick="triggerErasePlayer(this, pl_frame_pLETTER, \'LETTER\')"></label>\
          </div>\
          <input class="fam_check_box hidden mycheck" id="wtype_pLETTER" type="checkbox" onchange="changedWType(\'pLETTER\', this.checked)" >\
          <label class="fam_check mycheck_label wtype_label" for="wtype_pLETTER">Two Warriors</label>\
          <input id="sel_code_w1_pLETTER" class="hidden sc-check" onclick="triggerSrc(\'pLETTER\', 1)" type="radio" name="src_select">\
          <label id="sel_code_lbl_w1_pLETTER" class="sc-btn src_sel_but" for="sel_code_w1_pLETTER" >Player_LETTER</label>\
          <br>\
          <input id="sel_code_w2_pLETTER" class="hidden sc-check" onclick="triggerSrc(\'pLETTER\', 2)" type="radio" name="src_select">\
          <label id="sel_code_lbl_w2_pLETTER" class="sc-btn src_sel_but" for="sel_code_w2_pLETTER">Player_LETTER2</label>\
        </div>'

    addTextChild(players_contaier, text.replace(/LETTER/g, g_nextLetter))

    var letter = g_nextLetter
    g_srcButtons.push('sel_code_w1_p' + letter)
    g_srcButtons.push('sel_code_w2_p' + letter)

    j_addPlayer('p'+letter, "Player " + letter)
    changedWType('p'+letter, false) // do update label

    g_usedLetters.push(letter)
    g_nextLetter = asciiAdd(g_nextLetter, 1)


}

function changedWType(label, v, move_ui)
{
    if (v === true)
        v = 'TWO_DIFFERENT'
    else if (v == false)
        v = 'SINGLE'

    if (move_ui) {
        var checked = (v = 'TWO_DIFFERENT')
        document.getElementById('wtype_' + label).checked = checked
    }

    var elem1 = document.getElementById('sel_code_lbl_w1_' + label)
    var elem2 = document.getElementById('sel_code_lbl_w2_' + label)
    var frame = document.getElementById('pl_frame_' + label)

    if (v == 'SINGLE' || v == 'TWO_IDENTICAL') {
        elem2.style.visibility = 'hidden'
        elem2.style.opacity = 0.0
        elem1.style.marginTop = '7px'
        frame.style.height = '98px'
    }
    else if (v == 'TWO_DIFFERENT') {
        elem2.style.visibility = 'visible'
        elem2.style.opacity = 1
        elem1.style.marginTop = '7px'
        frame.style.height = ''
    }

    j_changedWType(label, v);

}


function triggerSrc(label, index)
{
    j_srcSelectionChanged(label, index)
}

function triggerErasePlayer(buttonElem, elem, letter)
{
    if (buttonElem.getAttribute("disabled") == "true")
        return;
    //elem.parentNode.removeChild(elem);
    elem.addEventListener('animationend', function() {
        elem.parentNode.removeChild(elem);
    })
    elem.classList.add('removed_anim')

    arrayRemove(g_usedLetters, letter);
    arrayRemove(g_srcButtons, 'sel_code_w1_p' + letter)
    arrayRemove(g_srcButtons, 'sel_code_w2_p' + letter)

    j_removePlayer('p'+letter)

    if (g_usedLetters.length == 0) {
        g_nextLetter = 'A'
    }
    else
    {
        // figure out what would be the next letter
        var check = 'Z' // check from Z backwards
        while(true) {
            if (g_usedLetters.indexOf(check) > -1)
                break;
            check = asciiAdd(check, -1)
        }
        if (check != 'Z')
            g_nextLetter = asciiAdd(check, 1)
        else {  // all letters are used up, check for holes
            check = 'A'
            while(check != 'Z') {
                if (g_usedLetters.indexOf(check) == -1)
                    break;
                check = asciiAdd(check, 1)
            }
            g_nextLetter = check // upper limit on number of players should avoid this causing a problem
        }
    }
}

var g_nextZombNum = 1

function addZombieCode() {
    if (addZombieBtn.getAttribute("disabled") == "true")
        return;
    var text = '<div id="zomb_line_zNUM">\
        <input id="sel_code_w1_zNUM" class="hidden sc-check" onclick="triggerSrc(\'zNUM\', 1)" type="radio" name="src_select">\
        <label id="player_name_lbl_zNUM" class="sc-btn src_sel_but zomb_sel_but" for="sel_code_w1_zNUM" >Zombie NUM</label>\
        <label id="player_erase_zNUM" class="pl_close_icon za_close_icon" onclick="triggerEraseZombie(this, zomb_line_zNUM, \'NUM\')"></label>\
        </div>'

    addTextChild(zombies_container, text.replace(/NUM/g, g_nextZombNum))
    var num = '' + g_nextZombNum  // turn to a string
    g_nextZombNum += 1

    g_usedZnums.push(num)

    j_addPlayer('z'+num, "Zombie " + num) // players are identified by a letter, zombies by a number

}

function triggerEraseZombie(buttonElem, elem, num) {
    if (buttonElem.getAttribute("disabled") == "true")
        return;

    elem.parentNode.removeChild(elem);
    arrayRemove(g_usedZnums, num)

    j_removePlayer('z'+num)
}


// Java code comes to get and clear this variable to get the stdout of the nasm run
var g_outputText = null
function printConsole(line) {
    //console.log("*** " + line)
    g_outputText += line + '\n'
}


// in case there is a long line, when returning to a new line, the text will be still scrolled to the left, fix that
function fixhscroll(e) {
    if (e.target != asm_edit)
        return;

    if (asm_edit.selectionStart == 0 || asm_edit.selectionStart == 1)
    {
        // console.log("fixing scroll")
        asm_edit.scrollLeft = 0
        asm_edit.scrollTop = 0
    }
    else if (asm_edit.value[asm_edit.selectionStart-1] == '\n' || asm_edit.value[asm_edit.selectionStart-2] == '\n')
    {
        asm_edit.scrollLeft = 0
    }
}



// called when a warning or error line in the editor is double clicked
function asm_cursorToLine(charOffset) {
    asm_edit.selectionStart = charOffset
    asm_edit.selectionEnd = charOffset
    asm_edit.focus()

}

/*function asm_pre_mousewheel(event) {
    asm_edit.dispatchEvent(new event.constructor(event.type, event));
}  scrolling in the code and numbers panes not working */


function handle_asm_edit_scroll() {
    var roundedScroll = Math.floor(asm_edit.scrollTop);

    // Fixes issue of desync text on mouse wheel, fuck Firefox.
    if(navigator.userAgent.toLowerCase().indexOf('firefox') < 0) {
        asm_edit.scrollTop = roundedScroll;
    }

    asm_pre.style.top = "-" + roundedScroll + "px"
    //asm_pre.scrollTop = asm_edit.scrollTop

    asm_show.style.left = "-" + asm_edit.scrollLeft + "px"
}

function fixTabKey(e) {
    if (e.keyCode === 9){
        var selStartPos = asm_edit.selectionStart
        var inputVal = asm_edit.value;
        e.preventDefault();

        asm_edit.value = inputVal.substring(0, selStartPos) + "    " + inputVal.substring(selStartPos, inputVal.length);
        asm_edit.selectionStart = selStartPos + 4;
        asm_edit.selectionEnd = selStartPos + 4;
        asm_edit.dispatchEvent(new Event("input")) // trigger the java parsing
    }
}

function fixIndent(e) {
    if (e.keyCode === 13)
    { // line indentation
        var selStartPos = asm_edit.selectionStart
        var inputVal = asm_edit.value;
        var pos = selStartPos - 2 // skip the last added \n (previous line)
        var seenSpaces = 0;
        // go to the start of the line, check if there is indentation there
        while (pos >= 0) {
            if (inputVal[pos] == ' ')
                ++seenSpaces;
            else if (inputVal[pos] == '\n')
                break;
            else
                seenSpaces = 0;
            --pos;
        }
        if (seenSpaces > 0) {
            // problem with this is it flushes the undo buffer, test initTextEvent ?
            asm_edit.value = inputVal.substring(0, selStartPos) + " ".repeat(seenSpaces) + inputVal.substring(selStartPos, inputVal.length);
            asm_edit.selectionStart = selStartPos + seenSpaces;
            asm_edit.selectionEnd = selStartPos + seenSpaces;
            j_asm_edit_changed() // simulate input
        }
    }
}

var debug_area_shown = false
var deferredEditorToAddress = -1 // set by code in CodeEditor.java

var prevDebug = false;
function triggerDebug() {
    console.log("triggerDebug " + debugCheckbox.checked)
    if (prevDebug == debugCheckbox.checked) // not sure how this is possible
        return;
    prevDebug = debugCheckbox.checked

    if (debugCheckbox.checked)
    {
        if (!j_startDebug()) {
            console.error("cannot start debug")
            debugCheckbox.checked = false;
            prevDebug = debugCheckbox.checked
            return
        }

        debugBtnIn.style.backgroundImage = "url(red_stop.png)"
        debugBtnIn2.innerText = "Stop"
        competeCheckbox.setAttribute("disabled", true);

        edit_area.style.display="none"
        debug_area.style.display=""
        if (!debug_area_shown) {
            fix_debug_scroll_placeholders_size()
            debug_area_shown = true; // need to do this fix only on the first time it's shown
        }

        // we do this only here because it needs to be done after the current page is shown.
        if (deferredEditorToAddress == -1)
            throw "no deferred scroll set?"

        scrollToAddr(deferredEditorToAddress)
        deferredEditorToAddress = -1;
        debugAreaScroll(true)  // force scroll render due to dirty pages
        j_debugUiInited();

        // disable editing the players
        addPlayerBtn.setAttribute("disabled", true)
        for(var ui in g_usedLetters) {
            var u = g_usedLetters[ui]
            document.getElementById("player_erase_p" + u).setAttribute("disabled", true)
            document.getElementById("player_check_p" + u).setAttribute("disabled", true)
            document.getElementById("wtype_p" + u).setAttribute("disabled", true)
        }
        player_check_zombies.setAttribute("disabled", true)
        addZombieBtn.setAttribute("disabled", true)
        for(var uzi in g_usedZnums) {
            var uz = g_usedZnums[uzi]
            document.getElementById("player_erase_z" + uz).setAttribute("disabled", true)
        }
    }
    else {
        j_stopDebug()

        debugBtnIn.style.backgroundImage = ""
        debugBtnIn2.innerText = "Debug"
        competeCheckbox.removeAttribute("disabled");

        edit_area.style.display=""
        debug_area.style.display="none"


        addPlayerBtn.removeAttribute("disabled")
        for(var ui in g_usedLetters) {
            var u = g_usedLetters[ui]
            document.getElementById("player_erase_p" + u).removeAttribute("disabled")
            document.getElementById("player_check_p" + u).removeAttribute("disabled")
            document.getElementById("wtype_p" + u).removeAttribute("disabled")
        }
        player_check_zombies.removeAttribute("disabled")
        addZombieBtn.removeAttribute("disabled")
        for(var uzi in g_usedZnums) {
            var uz = g_usedZnums[uzi]
            document.getElementById("player_erase_z" + uz).removeAttribute("disabled")
        }

    }
}

function triggerRegBase(ishex) {
    if (ishex) {
        hexCheckbox.checked = true;
        decCheckbox.checked = false;
    }
    else {
        hexCheckbox.checked = false;
        decCheckbox.checked = true;
    }
    j_setRegistersBase(ishex ? 16:10)
}

function loadAddrUpdateUI() {
    if (asm_load_addr_type.value == "rand") {
        fixed_load_addr.style.visibility = "hidden";
        fixed_load_addr.style.opacity = "0.0";
    }
    else {
        fixed_load_addr.style.visibility = "visible";
        fixed_load_addr.style.opacity = "1.0";
    }

}
function changedLoadAddrType() {
    loadAddrUpdateUI()
    j_loadAddrChanged(fixed_load_addr.value, asm_load_addr_type.value == "rand");

}
function changedFixedAddr() {
    j_loadAddrChanged(fixed_load_addr.value, asm_load_addr_type.value == "rand");
}
// from java, when changing warrior
function updateLoadAddr(strValue, isRand) {
    asm_load_addr_type.value = isRand ? "rand":"fixed"
    fixed_load_addr.value = strValue
    loadAddrUpdateUI()
}


function addTableChild(elem, txt) {
    var dummy = document.createElement("TABLE")
    dummy.innerHTML = txt
    elem.appendChild(dummy.firstChild.firstChild)
    // firstChild of table is tbody added automatically, bypass it
}

// grip idea from http://jsfiddle.net/thrilleratplay/epcybL4v/
var g_watchId = 0;
var watch_expr_list = []
var watch_expr_size = null  // size as dragged by the grip

function addWatchLine() {
    var wid = g_watchId++

    var text = '<div class="watch_row" id="watchID">\
                  <div class="watch_expr allow_select" id="watchID_expr" style="width:100px;">\
                     <div id="watchID_expr_content" class="watch_expr_content">&nbsp;</div>\
                     <input type="text" class="watch_expr_edit" id="watchID_expr_edit" spellcheck="false">\
                     <div class="watch_grip" id="watchID_grip"></div>\
                  </div><div class="watch_val allow_select" id="watchID_val"></div>\
                  <div id="watchID_del_but" class="sc-btn watch_del_but" title="Remove watch"></div> \
               </div>'
    text = text.replace(/ID/g, wid)

    addTextChild(watchArea, text)
    //add_watch_but.style.top = (watch_expr_list.length * 21 + 21) + "px"

    var grip = document.getElementById("watchID_grip".replace(/ID/g, wid) )
    var expr = document.getElementById("watchID_expr".replace(/ID/g, wid) )
    watch_expr_list.push(expr)
    if (watch_expr_size != null)
        expr.style.width = watch_expr_size + 'px';
    var expr_edit = document.getElementById("watchID_expr_edit".replace(/ID/g, wid) )
    var expr_content = document.getElementById("watchID_expr_content".replace(/ID/g, wid) )
    var valu = document.getElementById("watchID_val".replace(/ID/g, wid) )
    var delbut = document.getElementById("watchID_del_but".replace(/ID/g, wid) )

    j_addWatch(wid)

    expr.addEventListener('click', function(e) {
        expr_edit.style.visibility = "visible"
        expr_edit.focus()
        // TBD should somehow put the cursor in the expected place inside expr_edit
        // measure the text and use selectionStart, selectionEnd to place the cursor

    });
    expr_edit.addEventListener('change', function() { // enter was pressed
        //expr_content.innerText = expr_edit.value;
        expr_edit.style.visibility = "hidden"
        // if it's the last one being edited and there is a non empty value written in it, add another one
        if (watch_expr_list.indexOf(expr) == watch_expr_list.length - 1 && valu.innerText != "") {
            addWatchLine();
        }
    });
    expr_edit.addEventListener('input', function() { // enter was pressed
        var result = j_watchTextChanged(expr_edit.value, wid)
        if (result == false)
            expr_content.innerHTML = "&nbsp;"; // without this the watch window layout gets messed up for some reason
        else
            expr_content.innerText = expr_edit.value;
    });
    expr_edit.addEventListener('blur', function() { // enter was pressed
        expr_edit.style.visibility = "hidden"
    });

    delbut.addEventListener("click", function() {
        if (watch_expr_list.length == 1)
            return // don't delete the last one
        if (watch_expr_list.indexOf(expr) == watch_expr_list.length - 1 && valu.innerText == "")
            return // don't delete the last one that is empty that was last edded
        var idx = watch_expr_list.indexOf(expr)
        if (idx == -1)
            return // should not happen
        var row = document.getElementById("watchID".replace(/ID/g, wid) )
        watchArea.removeChild(row)
        j_delWatch(wid)
        watch_expr_list.splice(idx, 1)
    });


    var moving = false;
    var startOffset;

    grip.addEventListener('mousedown', function(e) {
        moving = true;
        startOffset = watch_expr_list[0].offsetWidth - e.pageX;
        //console.log("CAPTURE")
    });


    document.addEventListener('mousemove', function(e) {
      if (moving) {
          watch_expr_size = startOffset + e.pageX
          for(var elemi in watch_expr_list)
              watch_expr_list[elemi].style.width = watch_expr_size + 'px';
          e.preventDefault(); // prevent selection action from messing it up

          //console.log(watch_expr_size + "  " + watchArea.offsetWidth - 30)
          if (watch_expr_size > watchArea.offsetWidth - 50)
              watchArea.style.overflowX = "auto"
          else
              watchArea.style.overflowX = "hidden"
      }
    });

    document.addEventListener('mouseup', function() {
        moving = false;
        //console.log("-release")
    });

}

function triggerUploadBinChanged()
{
    if (uploadBinInput.files.length == 0)
        return
    var file = uploadBinInput.files[0]
    uploadBinInput.value = ""  // reset it so that next time we could upload the same filename again

    var reader = new FileReader();
    reader.onload = function(e) {
        j_loadBinary(e.target.result)
    }
    reader.onerror = function(e) {
        console.error(e)
    }
    reader.readAsArrayBuffer(file);


    return false
}

//-------------------------------- warCanvas wheel zoom -----------------
// https://github.com/jackmoore/wheelzoom/blob/master/wheelzoom.js

var width;
var height;
var bgWidth;
var bgHeight;
var bgPosX;
var bgPosY;
var previousEvent = null;
var downEvent = null
var settings = {
    zoom: 0.10,
    maxZoom: false,
    initialZoom: 1,
};
var warCtx = null;

function js_updateFromKeyScroll(nx, ny) {
    bgPosX = nx;
    bgPosY = ny;
    updateBgVars();
}

function updateBgVars() {
    if (bgPosX > 0) {
        bgPosX = 0;
    } else if (bgPosX < width - bgWidth) {
        bgPosX = width - bgWidth;
    }

    if (bgPosY > 0) {
        bgPosY = 0;
    } else if (bgPosY < height - bgHeight) {
        bgPosY = height - bgHeight;
    }

    var hscale = bgWidth / width;
    var vscale = bgHeight / height
    j_warCanvas_setTransform(hscale, vscale, bgPosX, bgPosY);
}

function updateBgStyle() {
    updateBgVars();
    j_warCanvas_repaint();
}

function wheelzoom_reset() {
    bgWidth = width;
    bgHeight = height;
    bgPosX = bgPosY = 0;
    updateBgStyle();
}

function onWarCanvasWheel(e) {
    var deltaY = 0;

    e.preventDefault();

    if (e.deltaY) { // FireFox 17+ (IE9+, Chrome 31+?)
        deltaY = e.deltaY;
    } else if (e.wheelDelta) {
        deltaY = -e.wheelDelta;
    }

    // As far as I know, there is no good cross-browser way to get the cursor position relative to the event target.
    // We have to calculate the target element's position relative to the document, and subtrack that from the
    // cursor's position relative to the document.
    var rect = warCanvas.getBoundingClientRect();
    var offsetX = e.pageX - rect.left - window.pageXOffset - WC_MARGIN_LEFT;
    var offsetY = e.pageY - rect.top - window.pageYOffset - WC_MARGIN_TOP;

    // Record the offset between the bg edge and cursor:
    var bgCursorX = offsetX - bgPosX;
    var bgCursorY = offsetY - bgPosY;

    // Use the previous offset to get the percent offset between the bg edge and cursor:
    var bgRatioX = bgCursorX/bgWidth;
    var bgRatioY = bgCursorY/bgHeight;

    // Update the bg size:
    if (deltaY < 0) {
        bgWidth += bgWidth*settings.zoom;
        bgHeight += bgHeight*settings.zoom;
    } else {
        bgWidth -= bgWidth*settings.zoom;
        bgHeight -= bgHeight*settings.zoom;
    }
    //console.log("sz: " + bgWidth + "," + bgHeight);

    if (settings.maxZoom) {
        bgWidth = Math.min(width*settings.maxZoom, bgWidth);
        bgHeight = Math.min(height*settings.maxZoom, bgHeight);
    }

    // Take the percent offset and apply it to the new size:
    bgPosX = offsetX - (bgWidth * bgRatioX);
    bgPosY = offsetY - (bgHeight * bgRatioY);

    // Prevent zooming out beyond the starting size
    if (bgWidth <= width || bgHeight <= height) {
        wheelzoom_reset();
    } else {
        updateBgStyle();
    }
}

function drag(e) {
    e.preventDefault();
    bgPosX += e.pageX - previousEvent.pageX;
    bgPosY += e.pageY - previousEvent.pageY;
    previousEvent = e;
    updateBgStyle();
}

function removeDrag(e) {
    var clickDx = Math.abs(e.pageX - downEvent.pageX);
    var clickDy = Math.abs(e.pageY - downEvent.pageY);
    if (clickDx < 6 && clickDy < 6) {
        var rect = warCanvas.getBoundingClientRect();
        var offsetX = e.pageX - rect.left - window.pageXOffset - WC_MARGIN_LEFT;
        var offsetY = e.pageY - rect.top - window.pageYOffset - WC_MARGIN_TOP;
        j_warCanvas_click(offsetX, offsetY);
    }


    document.removeEventListener('mouseup', removeDrag);
    document.removeEventListener('mousemove', drag);
}

function mouseMoveShowCurrent(e) {
    var rect = warCanvas.getBoundingClientRect();
    var offsetX = e.pageX - rect.left - window.pageXOffset - WC_MARGIN_LEFT;
    var offsetY = e.pageY - rect.top - window.pageYOffset - WC_MARGIN_TOP;
    j_warCanvas_showCurrent(offsetX, offsetY);
}

function warCanvasDraggable(e) {
    e.preventDefault();
    previousEvent = e;
    downEvent = e;
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', removeDrag);
}

function js_initZoom() {
    warCanvas.addEventListener('wheel', onWarCanvasWheel);
    warCanvas.addEventListener('mousedown', warCanvasDraggable);
    warCanvas.addEventListener('mousemove', mouseMoveShowCurrent);

    warCtx = warCanvas.getContext('2d');
}
function js_resetZoom() {
    var initial = 1;
    //var computedStyle = window.getComputedStyle(warCanvas, null);

    width = 256*3; //parseInt(computedStyle.width, 10);
    height = 256*3; //parseInt(computedStyle.height, 10);
    bgWidth = width * initial;
    bgHeight = height * initial;
    bgPosX = -(bgWidth - width)/2;
    bgPosY = -(bgHeight - height)/2;
    updateBgStyle();
}

// ------------------------------------------ Competition --------------------------------------------

function graph_panel_anim_end() {
    if (competeCheckbox.checked) {
        // setting the style in the normal way doesn't work here for some reason
        graphs_panel.setAttribute("style", "opacity: 1; transition: width 0.3s cubic-bezier(0.36, 0.29, 0.79, 1.07), opacity 0.3s cubic-bezier(0.56, 0.02, 0.89, 0.26);");
    }
    else {
        graphs_panel.style.transition = "";
    }
}

function gray_out_anim_end() {
    if (competeCheckbox.checked) {
    }
    else {
        gray_out_debugger.style.visibility = "hidden";
        //gray_out_debugger.style.transition = "";
    }
}

function openCompete() {
    if (competeCheckbox.checked) {
        graphs_panel.style.width = "";
        graphs_panel.style.opacity = 1;
        gray_out_debugger.style.visibility = "visible";
        gray_out_debugger.style.opacity = 1;
        debugCheckbox.setAttribute("disabled", true);
        debugBtn.setAttribute("disabled", true);
    }
    else {
        graphs_panel.style.width = "0";
        graphs_panel.style.opacity = 0;
        gray_out_debugger.style.opacity = 0;
        debugCheckbox.removeAttribute("disabled");
        debugBtn.removeAttribute("disabled");
    }
}

function triggerStartCompete()
 {
    if (competeRunCheckbox.checked)
    {
        if (!j_startCompete()) {
            console.error("cannot start competition")
            competeRunCheckbox.checked = false;
            return
        }

        competeRunBtnIn.style.backgroundImage = "url(red_stop.png)"
        competeRunBtnIn2.innerText = "Stop"
    }
    else {
        j_stopCompete()

    }
}
function competeFinished()
{
    competeRunBtnIn.style.backgroundImage = ""
    competeRunBtnIn2.innerText = "Start!"
    competeRunCheckbox.checked = false
}


</script>    
<style>
body {
    margin: 0;
    -moz-user-select: -moz-none;
    -khtml-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
     user-select: none;
    background: #ffffff;
    font-family: Verdana;
}

.sc-btn {
  display: inline-block;
  /*position: absolute;*/

  /*font-family: "Helvetica Neue", "Helvetica", sans-serif;*/

  border-radius: 0.4em;

  box-shadow: inset rgba(0, 0, 0, 0.1) 0px -0.15em 0px, inset rgba(255, 255, 255, 0.2) 0px 0.15em 0px, rgba(0, 0, 0, 0.3) 0px 0.1em 0.3em;
  text-align: center;
  cursor: pointer;
  overflow: hidden; 
  
  color: #222;
  text-shadow: rgba(127, 127, 127, 0.4) 0 1px 0;
  background-color: #ebebeb;
  background-image: linear-gradient(to bottom, white, #ebebeb);   
  
  width: 100px;
  height: 40px;
  line-height: 40px;
  margin: 7px;
  outline:none;  /* no focus outline */
  font-size:110%;
}

.sc-btn:hover {
  color: #222;
  background-image: linear-gradient(to bottom, white, #d2d2d2);
  background-color: #fdfdfd;   
}

.sc-btn:active, .sc-check:checked+.sc-btn {
    box-shadow: rgba(255, 255, 255, 0.2) 0 0.1em 0, inset rgba(0, 0, 0, 0.3) 0px 0.25em 1em; 
    color: #fff;
    background-color: #dfdfdf;
    background-image: linear-gradient(to bottom, #479ceb, #1067c1); 
}
.sc-btn:checked  {

  background-color: #dfdfdf;
  background-image: linear-gradient(to bottom, #479ceb, #1067c1); 
}
.sc-btn:disabled {
   color: #ddd;
}

.sc-btn[disabled="true"] {
    box-shadow: initial;
    cursor: initial;
}
.sc-btn[disabled="true"] > .sc-span { /* comes after */
    opacity: 0.3; /* for buttons with image*/
}

input[type="range"]:disabled {
    opacity: 0.4;
}

input:disabled + .sc-btn,
input:disabled + .sc-btn:hover,
input:disabled + .sc-btn:active, 
.sc-btn[disabled="true"] {
  color:#ddd;
  background-image: linear-gradient(to bottom, white, #ebebeb);
  box-shadow: initial;
}
.sc-btn:disabled + span {
  opacity:0.6
}

/* ---------------- asm ---------------------- */

.codearea {
    font-size: 16px;
    font-family: courier;
    outline: none; /* don't show focus border */
    overflow: auto;
    /*border: 1px solid #000000;*/
    /*border-radius: 4px;*/
    display: inline-block;
    padding: 9px 8px;
    white-space: pre;  /* needed for multiple spaces */
    box-sizing: border-box; /* size includes margins and border */
}
.codearea:disabled {
    background-color: rgb(255,255,255);
    color: rgb(0, 0, 0);
}

.allow_select {
    -moz-user-select: text; /* user can select here, override body */
    -khtml-user-select: text;
    -webkit-user-select: text;
    -ms-user-select: text;
     user-select: text;
}

#opcodes_edit {
    position: absolute;
    left: 0;

    width:200px;
    overflow: hidden; /* remove scroll bar */
    background: white;
}
#asm_linenums {
    position: absolute;
    left: 200px;

    width: 40px;
    border: none;
    padding: 9px 3px 9px 9px;
    text-align: right;
    color: #888888;
    overflow: hidden;
    border-radius: 0;

    background: #eeeeee;
    border-right: 1px solid #cccccc;

    margin: 0 0 1px 0; /* without this the editor is off by 1 pixel in chrome. no idea */
}

.dbg_breakpoint:after {
    content: url(breakpoint_light.png);
    position: absolute;
    left: 31px;
}

.edit_breakpoint:after {
    /*background: #ff5555;*/
    /*background: url(breakpoint_light.png) no-repeat right center;*/
    content: url(breakpoint_light.png);
    position: absolute;
    right: 2px;
}

#edit_area {
    display: inline-block;
    position:relative;

    width:600px;
    height: 518px;
    vertical-align: top; /* othewise the scroll bar hides the border */
    overflow: hidden;
}

#debug_area {
    position: relative; /* for the absolute positiond gray address bar */
}
#debug_text {
    display: inline-block;
    position:relative;

    width:600px;
    height: 518px;
    vertical-align: top; /* othewise the scroll bar hides the border */
    border: 1px solid black;
    border-radius: 6px;
    overflow: auto;
    font-size: 16px;
    font-family: courier;
    margin: 0;
    padding: 0 0 0 3px;
    cursor: default;
}
.dplace { /* placeholdr for dlines */
    height: 0;
}
#dbg_box_addr {
    position: absolute;
    top: 31px;
    width: 50px;
    height: calc( 100% - 31px);
    background: #eeeeee;
    border-right: 1px solid #cccccc;
}

#asm_edit {
    position: absolute;
    top: 0;
    left: 240px;
    height: 100%;
    width: calc(100% - 240px);
    overflow-x: auto;
    border:none;
    background: transparent;
    outline: none;
    resize: none;
    margin: 0;
    box-sizing: border-box;
    /*opacity: 0.2;*/
    color: transparent;
    caret-color: black;
}
#asm_pre {
    /*pointer-events: none;*/
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-x: hidden;
    overflow-y: hidden;
    border:none;
    margin: 0;
    box-sizing: border-box;
    padding: 0;

}
#asm_show {
    position: absolute;
    display: inline-block;
    box-sizing: border-box;
    font-family: courier;
    vertical-align: top;
    border: none;
}

#asm_show_rel {
    position: relative;
    left: 240px;

    display: inline-block;
    /*width: calc(600px - 240px);*/
    /*height: 500px;*/
    vertical-align: top;
   /* overflow: hidden;*/
}

#asm_edit_and_lines {
    border: 1px solid #000000;
    border-radius: 4px;
    display: inline-block;
    height: 518px; /* 500 + padding of 9 */
}


#box_opcodes {
    position: absolute;
    top: 0;
    left: 0;
    width: 192px;
    height: 100%;
    border: 1px solid #000;
    border-radius: 6px;
    pointer-events: none;  /* want these boxes to be transparent to the mouse */
    box-sizing: border-box;
}
#box_edit {
    position: absolute;
    top: 0;
    left: 200px;
    width: 400px;
    height: 100%;
    border: 1px solid #000;
    border-radius: 6px;
    pointer-events: none;
    box-sizing: border-box;
}
#box_numbers {
    position: absolute;
    top: 0;
    left: 200px;
    width: 39px;
    height: 100%;
    background: #eeeeee;
    border-right: 1px solid #cccccc;

}



.edit_error {
    background-color: #ffd7d7;
}
.edit_warning {
    background-color: #fff8ab;
}
#asm_output { 
    width:600px;
    height:100px;
    white-space: normal;
    padding: 9px 0 9px 0;
    border: 1px solid #000000;
    border-radius: 4px;
    margin: 8px 0 0 0;
}
#asm_options {
    margin: 8px 0 0 0;
}

.my_combo_box {
    border-radius: 6px;
    font-size: 14px;
    height: 25px;
}

#asm_load_addr_type {
}

.edit_text_error {
    background-color: rgb(255,140,140);
}

.stdout_line_w:nth-child(even) {
    background: #ffeb8b;
    cursor: pointer;
}
.stdout_line_w:nth-child(odd) {
    background: #ffffaf;
    cursor: pointer;
}

.stdout_line_e:nth-child(even) {
    background: #ffcece;
    cursor: pointer;
}
.stdout_line_e:nth-child(odd) {
    background: #ffbcb4;
    cursor: pointer;
}


.stdout_line_e, .stdout_line_w {
    padding: 0 0 0 8px;
}

.current_dbg {
    background-color: #ddddff;
}
.current_dbg_dead {
    background-image: url("dbg_fail_red_ex.png");
    background-color: #ffc7c7;
    background-repeat: no-repeat;
    background-position: calc( 100% - 5px) 1px;
}
.current_dbg_dead > .dbg_backfill {
    color: #000000;
}

.dbg_comment_line {
    /*background-color: white; no needed since if there's a comment first line will be in a dfXXXX div */
}
.dbg_opcodes {
    display: inline-block;
    width: 200px;
}
.dbg_backfill {
    color: #c1c1c1;
}

/*--------------- side panel -----------------*/

#players_panel {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    background: #ececec;
    width: 190px;
    border-right: 1px solid #008800;
    overflow: auto;
}

#action_panel {
  position: absolute;
  left: 200px;
  top: 0;
  bottom: 0;
  right: 0;
  overflow: auto;
}
#action_rel {
  position: relative;
}
#gray_out_debugger {
    position: absolute;
    background: rgba(200,200,200,0.8);
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    visibility: hidden;
    left: 190px;
    top: 0;
    bottom: 0;
    right: 0;
    overflow: hidden;
}

#edit_panel {
  position: absolute;
  left: 0;
  top: 0;
  width: 600px;
  margin: 8px;
}
#memory_panel {
  position: absolute;
  left: 630px;
  top: 0;

}

#players_rel {
    position: relative;
    width: 100%;
    top: 10px;
    /*bottom: 20px;*/
}

.hidden {
    position: absolute;
    z-index: -2;
    opacity: 0;
}

@keyframes fadeIn {
    from {opacity:0;}
    to {opacity:1;}
}
@keyframes fadeOut {
    from { opacity:1;  }
    to {opacity:0; }
}



.toppic {
    margin: 10px 11px 5px 10px;
    background: #cfcfcf;
    font-family: Verdana;
    padding: 4px;
    border-radius: 5px;
    height: 142px;
    transition: height 0.1s ease-in-out;
    animation: fadeIn 200ms;
    line-height: 26px;
    overflow: hidden;
}
.removed_anim {
    animation: fadeOut 100ms;
}

.famtitle {
    height: 26px;
    line-height: 26px;
}

.mycheck + .mycheck_label {
    background-image: url(check_none.png);
    background-repeat: no-repeat;
    display: inline-block;
}
.mycheck:checked + .mycheck_label {
    background-image: url(check_checked.png);
}
.mycheck:indeterminate + .mycheck_label {
    background-image: url(check_int.png);
}
.mycheck[disabled="true"] + .mycheck_label {
    filter: brightness(90%);
}

.fam_check {
    width: 17px;
    height: 17px;
    margin: -4px 4px 0 2px;
    vertical-align: middle;
}
.fam_label {
    display: inline-block;
    width: calc(100% - 60px);
    max-width: calc(100% - 60px);
    overflow: hidden;
    vertical-align: bottom; /* needed becaue overflow hidden changed the baseline https://stackoverflow.com/questions/22421782/css-overflow-hidden-increases-height-of-container */
}
.sel_wtype {
    margin: 0 0 7px 3px;
    width: calc(100% - 7px);
}
.wtype_label {
    width: 200px;
    text-indent: 20px;
    line-height: 14px;
    margin: 0 0 0 20px;
    font-size: 85%;
    background-size: 14px;
}

.opt_single {
    background: url(check_none.png) no-repeat;
}
.src_sel_but {
    height: 30px;
    line-height: 30px;
    font-size: 16px;
    margin: 3px 0 0 15px;
    width: calc(100% - 20px);
    transition: opacity 0.1s ease-in-out, height 0.1s ease-in-out, margin-top 0.1s ease-in-out;
}

#addPlayerBtn {
    width: 34px;
    height: 34px;
    margin: 4px 7px 0px 11px;;
}
#addPlayerBtnIn {
    background-image: url(plus.png);
    background-position: center;
    background-repeat: no-repeat;
    display: inline-block;
    width: 34px;
    height: 33px;
}
.sc-btn[disabled="true"] > #addPlayerBtnIn {
    box-shadow: initial;
    background-image: linear-gradient( rgba(255,255,255, 0.4),rgba(255,255,255, 0.4) ), url(plus.png);
}
.sc-btn[disabled="true"] > #addZombieBtnIn {
    box-shadow: initial;
    background-image: linear-gradient( rgba(255,255,255, 0.4),rgba(255,255,255, 0.4) ), url(plus.png);
}

.pl_close_icon {
    width: 15px;
    height: 15px;
    background-image: url('reddish_ex.png');
    background-position: center;
    background-repeat: no-repeat;
    float: right;
    /*border: #aa0000 solid 1px;*/
    border-radius: 6px;
    padding: 4px;
}
.pl_close_icon:hover {
    background-image: url('red_ex.png');
    background-color: rgba(255,255,255,0.7);
}
.pl_close_icon[disabled="true"] {
    background-image: url('gray_ex.png');
    background-color: transparent;
}

#pl_frame_zombies {
    height:initial;
    padding-bottom: 0px;
}
#addZombieBtn {
    width: 28px;
    height: 28px;
    margin: 4px 7px 7px 15px;
}
#addZombieBtnIn {
    background: url(plus.png) 6px 5px no-repeat;
    display: inline-block;
    width: 28px;
    height: 28px;
}

.zomb_sel_but {
    width: calc(100% - 40px);
}
.za_close_icon {
    margin-top: 6px;
}

/* ------------------------------------------------------*/

#editor_title {
    height: 30px;
    width: 300px;
    margin: 6px 0 20px 0;
    font-size: 20px;
    border-radius: 5px;
    padding: 0 0 0 10px;
    border: 1px solid #000000;
}
#editor_boxes {
}

.small_editline {
    height: 19px;
    font-size: 16px;
    font-family: courier;
    border-radius: 6px;
    border: 1px solid #000000;
    padding: 2px;
    vertical-align: 1px;
    width: 100px;
}
#fixed_load_addr {
    visibility: hidden;
    opacity: 0;
    transition: all 0.12s ease-in-out;
}
#seed_edit {
    float:right;
}
#seed {
    margin-left: 3px;
}

#debug_goto {
    width: 100px;
    margin: 0 0 6px 0;
    height: 18px;
    font-size: 16px;
    font-family: courier;
    border-radius: 4px;
    border: 1px solid #000000;
    padding: 2px;
}
#btnGoTo {
    height: 22px;
    line-height: 18px;
    vertical-align: -8px;
    border: 1px solid;
    width: 60px;
    line-height: 20px;
    margin: 0;
    font-size: 14px;
}
#stepnum_cont {
    float:right;
    display:inline-block;
    width: 8em;
    margin: 5px;
}

#debugBtn{
    width: 130px;
    text-align:left;
    margin-left: 20px;
}
#debugBtnIn {
    display: inline-block;
    width: 30px;
    height: 30px;
    vertical-align: -8px;
    margin: 0 0px 0 9px;
    background-image: url(green_play.png);
}
#debugBtnIn2 {
    margin: 0 0 0 3px;
}
#competeBtn{
    width: 130px;
    text-align:left;
    margin-left: 20px;
    margin-bottom: 0;
}
#competeBtnIn {
    display: inline-block;
    width: 30px;
    height: 30px;
    vertical-align: -8px;
    margin: 0 0px 0 9px;
}
#competeBtnIn2 {
    margin: 0 0 0 12px;
}

#competeRunBtn{
    width: 120px;
    text-align:left;
    margin: 10px 0 0 20px;
    height: 35px;
    line-height: 35px;

}
#competeRunBtnIn {
    display: inline-block;
    background-image: url(green_play.png);
    width: 30px;
    height: 30px;
    margin: 0 0px 0 9px;
    vertical-align: -10px;
    background-size: 80%;
    background-repeat: no-repeat;

}
#competeRunBtnIn2 {
    margin: 0 0 0 3px;
}

/* --------------------- cpuPanel --------------------- */

#cpuPanel {
    position: absolute;
    left: 0;
    top: 630px;
}
.reg_name {
    display: inline-block;
    text-align: right;
    width: 37px;
    font-family: courier;
    font-weight: bold;
}
.reg_long_name {
    width: 75px;
}
.reg_input {
    width: 60px;
    font-family: courier;
    font-weight: bold;
    border-radius: 4px;
    border: 2px solid #aaaaaa;
    height: 17px;
    margin: 2px 0 0 3px;
    padding: 1px 0 1px 3px;
    font-size: 16px;
}
#reg_flags_table {
    border: 1px solid #000000;
    /*border-collapse: collapse;*/
    margin: 5px;
    border-radius: 5px;
}
.flag_check {
    width: 17px;
    height: 17px;
}

#reg_flags_table td {
    border-left: 1px solid #000;
    width: 25px;
    text-align: center;
}
#reg_flags_table td:first-child {
    border-left: none;
}
#reg_flags_table .bytesep {
    border-left: 2px solid #000000;
}
.flag_unsed {
    background-color: #cccccc;
}
#reg_flags_table tr:first-child td:first-child {
    border-top-left-radius: 5px;
}
#reg_flags_table tr:last-child td:first-child {
    border-bottom-left-radius: 5px;
}

.dbg_reg_err {
    background-color: #ff9999;
}


#hex_dec {
    float: right;
    width: 70px;
    height: 90px;
}
#hexBtn, #decBtn {
    width: 45px;
    height: 35px;
    line-height: 35px;
    margin: 0 0 5px 20px;
    border: 1px solid #cccccc;
}

.base-btn:active, .sc-check:checked+.base-btn {
    background-image: linear-gradient(to bottom, #479ceb, #1067c1);
    /*color: #000;*/
}

.title-buttons {
    border: 1px solid;
    width: 77px;
    height: 30px;
    line-height: 29px;
    font-size: 17px;
    margin: 0;
}
#dbgButtons {
    margin: 0 0 6px 7px;
}
#btnPause {
}
#btnSingleRound {
}
#speedSliderCont {
    vertical-align: 10px;
    margin-left: 4px;
    line-height: 29px;
    border: 1px solid;
    height: 30px;
    display: inline-block;
    border-radius: 0.4em;
    padding: 0 5px 0 5px;
    box-shadow: inset rgba(0, 0, 0, 0.1) 0px -0.15em 0px, inset rgba(255, 255, 255, 0.2) 0px 0.15em 0px;
}
#speedSliderVal {
    width: 2.5em;
    display: inline-block;
}
#speedSlider {
    vertical-align: 1px;
}
#speedZero {
    width: 18px;
    height: 18px;
    margin: 0;
    border-radius: 3px;
    border: 1px solid #d2cfcf;
    display: inline-block;
    vertical-align: -4px;
    background-image: url(zero_but.png);
    background-repeat: no-repeat;
    background-position: 3px 3px;
}

.slider {
    -webkit-appearance: none;
    width: 170px;
    height: 10px;
    border-radius: 5px;
    background: #afafaf;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}
.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #555555;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #555555;
    cursor: pointer;
}



/* --------------------- cpuPanel bottom --------------------- */
#messagesArea {
    border: 1px solid #000000;
    height: 140px;
    display: inline-block;
    width: 600px;
    border-radius: 4px;
    margin: 10px 0 0 0;
}

.submem_area {
    border: 1px solid #000000;
    border-radius: 4px;
    display: inline-block;
    height: 180px;
    margin: 5px;
    position: relative;
}
#stackArea {
    width: 160px;
}
#sharedMemArea {
    width: 160px;
}

#stackView {
}
#sharedMemView {
}
.submem_title {
    background: #eaeaea;
    border-radius: 6px 6px 0 0;;
    border-bottom: 1px solid #000000;
    padding: 3px;
    text-align: center;
}
.submem_list {
    overflow: auto;
    height: calc( 100% - 28px );  /* minus header height */
    font-family: courier;
    font-size: 16px;
    padding: 2px 0 0 4px;
    white-space: pre;
}
.submem_box_addr {
    position: absolute;
    top: 26px;
    width: 58px;
    height: calc( 100% - 26px);
    background: #eeeeee;
    border-right: 1px solid #cccccc;
    z-index: -1; /* don't know why */
}

.atStackLine {
    background-color: #ddddff;
}
#watch_container {
    display: inline-block;
    height: 180px;
    width: 243px;
    border: 1px solid #000000;
    border-radius: 4px;
}

#watchArea {
    overflow-x:hidden;
    overflow-y:auto;
    height: calc( 100% - 26px); /* needed so that the scrollbar would show at the bottom */
    position: relative;
}

.watch_row {
    white-space:nowrap;
    height: 21px;
    position: relative; /* for X placement */
}

.watch_expr, .watch_val  {
    position: relative;
    border: 1px solid #000000;
    font-family: courier;
    font-size: 16px;
    height: 21px;
    line-height: 21px;

    display: inline-block;
    white-space: normal;

    border-top: none;
    border-left: none;
    padding: 0 0 0 3px;
    box-sizing: border-box;
}
.watch_expr {

}
.watch_val {
    border-right: none;
    width: 200px;
    overflow:hidden;
}

.watch_expr_edit {
    visibility: hidden;
    position: absolute;
    width: calc( 100% - 8px);
    top: 0;
    left: 3px;
    height: 100%;
    font-family:courier;
    font-size: 16px;
    border: none;
    padding: 0;

}
.watch_expr_content {
    overflow:hidden;
}

.watch_grip {
    position: absolute;
    height: 21px;
    width: 7px;
    right: -4px;
    top: 0;
    cursor: col-resize;
    z-index: 1;
}


#add_watch_but {
    width: 19px;
    height: 19px;
    background: url(small_plus.png) no-repeat;
    background-position: 3px 3px;
    background-color: #d5d5ff;
    line-height:18px;
    border-radius:3px;
    position: absolute;
    /* position from top set in code */
}


.watch_del_but {
    width: 19px;
    height: 19px;
    background-image: url(small_ex.png) !important;
    background-repeat: no-repeat;
    line-height:18px;
    border-radius:3px;
    position: absolute;
    left: calc(100% - 21px);
    margin: 0;
    background-position: 4px;
    background-color: #ffcdcd !important; /* override the sc-btn behaviour */
    display: none;
}
.watch_row:hover > .watch_del_but {
    display:initial;
}

#uploadBinBut {
    background-image: url(upload_bin.png);
    background-repeat: no-repeat;
    background-position: 2px 3px;
    height: 34px;
    width: 46px;
    position: absolute;
    border-radius: 5px;
}
#uploadBinBut:active {
    background-position: 3px 4px;
    background-image: linear-gradient(rgba(0, 0, 0, 0.1),rgba(0, 0, 0, 0.1)), url(upload_bin.png);
    background-repeat: repeat, no-repeat;
}

#hoverCellInfo {
    font: 14px monospace;
}

/*----------------------- graphs panel ---------------------------*/

#graphs_panel {
    position: absolute;
    top: 10px;
    left: 191px;
    width: 710px;
    background: linear-gradient(to right, #c9c9c9 0%,#fdfdfd 20px); /* http://www.colorzilla.com/gradient-editor/ */
    border: 1px solid;
    border-left: none;
    border-radius: 0 15px 15px 0;
   /* bottom: 30px;*/
    box-shadow: 2px 2px 14px -1px rgba(255, 255, 255, 1), 4px 4px 14px -1px rgba(0, 0, 0, 1);

    transition: width 0.3s cubic-bezier(0.36, 0.29, 0.79, 1.07), opacity 0.3s cubic-bezier(0.32, 0.57, 0.15, 1);
    box-sizing: border-box;
    overflow: hidden; /* when the panel is hidden, hide its content */
}

#graphs_canvas {
    margin: 10px 10px 10px 20px;
}

#graphs_title {
    border-bottom: 1px solid;
    text-align: center;
    padding: 5px;
    font-size: 120%;
    background: linear-gradient(to right, #c9c9c9 0%,#eeeeee 20px);

}

#battlesPerGroupField {
    height: 30px;
    width: 100px;
    margin: 12px 0 0 0;
    font-size: 18px;
    border-radius: 5px;
    padding: 0 0 0 10px;
    border: 1px solid #000000;
    vertical-align: top;
}
#battlesLabel {
    display: inline-block;
    vertical-align: top;
    margin: 12px 0 0 20px;
    line-height: 30px;
}
#battlesRan {
    display: inline-block;
    vertical-align: top;
    margin: 12px 14px 0 0;
    line-height: 30px;
    position: absolute;
    right: 0;
}
#graphs_control {
    overflow: hidden;
    position: relative;
    width: 709px;
}

</style>
  </head>
  <body onload="start()">

    <div id="action_panel"><div id="action_rel">
      <div id="memory_panel">
        <input type="checkbox" id="warCanvasDummyInput" class="hidden">
        <canvas id="warCanvas"></canvas>
        <div id="hoverCellInfo"></div>

      </div>

      <div id="edit_panel">
        <input type="text" id="editor_title" spellcheck="false">
        <input id="uploadBinInput" type="file" class="hidden" onchange="return triggerUploadBinChanged()">
        <label id="uploadBinBut" class="sc-btn" for="uploadBinInput" title="Upload binary file"></label>

        <br>
        <div id="editor_boxes">
          <div id="edit_area">
              <div id="box_numbers"></div>
              <pre id="asm_pre" class="codearea"><div id="asm_show_rel"><code id="asm_show" class="codearea"></code></div><code id="opcodes_edit" class="codearea allow_select" wrap="off"></code><code id="asm_linenums" class="codearea" wrap="off">1</code></pre>
              <textarea id="asm_edit" class="codearea allow_select" wrap="off"
                   spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off"
                   onscroll="handle_asm_edit_scroll()"></textarea>
              <div id="box_opcodes"></div> <!-- want these in front of the text but it ignores pointer events -->
              <div id="box_edit"></div>
          </div>
          <div id="debug_area" style="display:none;">
              <input type="text" id="debug_goto" spellcheck="false" onkeyup="triggerGoToKey()">
              <label id="btnGoTo" class="sc-btn" onclick="triggerGoTo()">go to</label>
              <span id="stepnum_cont">Step:<span id="stepnum">0</span></span>
              <div id="dbg_box_addr"></div>
              <pre id="debug_text" class="allow_select" onscroll="debugAreaScroll(false)"></pre>
          </div>
        </div>
        <div id="editor_bottom">
            <div id="asm_output" class="codearea allow_select" wrap="off" ></div>
            <div id="asm_options">
                Debug load address:
                <select id="asm_load_addr_type" class="my_combo_box" onchange="changedLoadAddrType()">
                    <option value="rand">Random</option>
                    <option value="fixed">Fixed</option>
                </select>
                <input type="text" class="small_editline" id="fixed_load_addr" spellcheck="false" value="A000" oninput="changedFixedAddr()">
                <span id="seed_edit">Seed:<input class="small_editline" id="seed" type="text" spellcheck="false"></span>

            </div>
        </div>

       <!-- <div id="watch_container">
          <div class="submem_title">Watch</div>
          <div id="watchArea">
          </div>
          </div>
        </div>-->

      </div>

      <div id="cpuPanel" style="display:none;">
        <div id="dbgButtons">
          <label id="btnPause" class="sc-btn title-buttons">Pause</label>
          <label id="btnSingleRound" class="sc-btn title-buttons">Step</label>
          <span id="speedSliderCont">Speed:<input type="range" min="-35" max="200" value="0" class="slider" id="speedSlider">
              <span id="speedSliderVal">0</span>
              <span id="speedZero" class="sc-btn base-btn" onclick="j_triggerZeroSpeed()"></span><br>
          </span>
        </div>
        <div id="registers_block">
          <div id="hex_dec">
            <input id="hexCheckbox" class="sc-check hidden" onchange="triggerRegBase(true)" type="checkbox" checked="true">
              <label id="hexBtn" class="sc-btn base-btn" for="hexCheckbox">Hex</label><br>
            <input id="decCheckbox" class="sc-check hidden" onchange="triggerRegBase(false)" type="checkbox">
              <label id="decBtn" class="sc-btn base-btn" for="decCheckbox">Dec</label>
          </div>
          <span class="reg_name">AX:</span><input type="text" id="reg_AX" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">BX:</span><input type="text" id="reg_BX" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">CX:</span><input type="text" id="reg_CX" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">DX:</span><input type="text" id="reg_DX" class="reg_input" maxlength="5" spellcheck="false"><br>
          <span class="reg_name">SI:</span><input type="text" id="reg_SI" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">DI:</span><input type="text" id="reg_DI" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">BP:</span><input type="text" id="reg_BP" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">SP:</span><input type="text" id="reg_SP" class="reg_input" maxlength="5" spellcheck="false"><br>
          <span class="reg_name">CS:</span><input type="text" id="reg_CS" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">DS:</span><input type="text" id="reg_DS" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">SS:</span><input type="text" id="reg_SS" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name">ES:</span><input type="text" id="reg_ES" class="reg_input" maxlength="5" spellcheck="false"><br>
          <span class="reg_name">IP:</span><input type="text" id="reg_IP" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name reg_long_name">Energy:</span><input type="text" id="reg_Energy" class="reg_input" maxlength="5" spellcheck="false">
          <span class="reg_name reg_long_name">Flags:</span><input type="text" id="reg_Flags" class="reg_input" maxlength="5" spellcheck="false"><br>
          <table id="reg_flags_table" cellspacing="0">
              <tr><td class="flag_unsed" title="Reserved"></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td title="Overflow Flag">OF</td><td title="Direction Flag">DF</td><td title="Interrupt Enable Flag">IF</td>
                  <td title="Trap Flag">TF</td><td class="bytesep" title="Sign Flag">SF</td><td title="Zero Flag">ZF</td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td title="Adjust Flag">AF</td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td title="Parity Flag">PF</td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td title="Carry Flag">CF</td></tr>
              <tr>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="OF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="OF_fcheck" title="Overflow Flag"></label></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="DF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="DF_fcheck" title="Direction Flag"></label></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="IF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="IF_fcheck" title="Interrupt Enable Flag"></label></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="TF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="TF_fcheck" title="Trap Flag"></label></td>
                  <td class="bytesep">
                      <input class="flag_check_box hidden mycheck" id="SF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="SF_fcheck" title="Sign Flag"></label></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="ZF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="ZF_fcheck" title="Zero Flag"></label></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="AF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="AF_fcheck" title="Adjust Flag"></label></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="PF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="PF_fcheck" title="Parity Flag"></label></td>
                  <td class="flag_unsed" title="Reserved"></td>
                  <td>
                      <input class="flag_check_box hidden mycheck" id="CF_fcheck" type="checkbox">
                      <label class="flag_check mycheck_label" for="CF_fcheck" title="Carry Flag"></label></td>
              </tr>
          </table>
          <div id="stackArea" class="submem_area">
              <div class="submem_title">Stack</div>
              <div class="submem_box_addr"></div>
              <div id="stackList" class="submem_list"></div>
          </div>
          <div id="sharedMemArea" class="submem_area">
              <div class="submem_title">Shared Memory</div>
              <div class="submem_box_addr"></div>
              <div id="sharedMemList" class="submem_list"></div>
          </div>
            <div id="watch_container">
                <div class="submem_title">Watch</div>
                <div id="watchArea">
                </div>
            </div>

          <br>
          <div id="messagesArea" class="codearea allow_select" wrap="off" ></div>
        </div>
      </div>

    </div></div>
    <div id="gray_out_debugger"  ontransitionend="gray_out_anim_end()" ></div>

    <div id="players_panel">
      <div id="players_rel">
        <input id="competeCheckbox" class="hidden sc-check" onchange="openCompete()" type="checkbox">
        <label id="competeBtn" class="sc-btn" for="competeCheckbox">
            <span id="competeBtnIn2">Competition</span>
        </label>
        <br>
        <input id="debugCheckbox" class="hidden" onchange="triggerDebug()" type="checkbox">
        <label id="debugBtn" class="sc-btn" for="debugCheckbox">
          <span id="debugBtnIn" class="sc-span"></span>
          <span id="debugBtnIn2">Debug</span>
        </label>
        <div id="players_contaier">

        </div>
        <label id="addPlayerBtn" class="sc-btn" onclick="addPlayersPanel()" title="Add Player"><span id="addPlayerBtnIn"></span></label>

        <div id="pl_frame_zombies" class="toppic">
            <div class="famtitle">
                <input class="fam_check_box hidden mycheck" id="player_check_zombies" type="checkbox" checked onchange="" >
                <label class="fam_check mycheck_label" for="player_check_zombies"></label>
                <label id="player_name_lbl_zombies" class="fam_label">Zombies</label>
            </div>
            <div id="zombies_container">

            </div>
            <label id="addZombieBtn" class="sc-btn" onclick="addZombieCode()" title="Add Zombie"><span id="addZombieBtnIn"></span></label>

        </div>


      </div>
    </div>

    <div id="graphs_panel" style="width:0; opacity:0;" ontransitionend="graph_panel_anim_end()">
        <div id="graphs_title">Competition</div>
        <div id="graphs_control">
            <input id="competeRunCheckbox" class="hidden" onchange="triggerStartCompete()" type="checkbox">
            <label id="competeRunBtn" class="sc-btn" for="competeRunCheckbox">
                <span id="competeRunBtnIn" class="sc-span"></span>
                <span id="competeRunBtnIn2">Start!</span>
            </label>
            <label id="battlesLabel">Battles to run:</label>
            <input id="battlesPerGroupField" type="text" spellcheck="false">
            <label id="battlesRan"></label>
            <canvas id="graphs_canvas" width="680" height="600"></canvas>
        </div>

    </div>

  </body>
</html>
